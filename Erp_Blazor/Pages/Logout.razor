@page "/logout"
@inject ILocalStorageService LocalStorage
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthStateProvider
@inject AuthService AuthService

<h3>Déconnexion en cours...</h3>

@code {
    protected override async Task OnInitializedAsync()
    {
        // Appeler l'API pour supprimer le cookie
        await AuthService.LogoutAsync();

        // Supprimer le token local
        await LocalStorage.RemoveItemAsync("authToken");

        // Marquer l'utilisateur comme déconnecté
        if (AuthStateProvider is CustomAuthStateProvider customProvider)
        {
            await customProvider.MarkUserAsLoggedOut();
        }

        // Rediriger vers la page de connexion
        NavigationManager.NavigateTo("/login", forceLoad: true);
    }
}